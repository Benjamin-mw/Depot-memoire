---
title: "k-Means"
author: "Eudes Lapaz"
date: "2023-04-01"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

## Import Package

```{r}
library(FactoMineR)
library(factoextra)
library(CASdatasets)
library(tidyverse)
library(MASS)
library(knitr)
library(ggplot2)
library(cowplot)
library(reshape2)
library(dplyr)
library(GGally)
library(corrplot)
library(carData) 
library(car)
library(questionr)
library(multcomp)
library(dplyr)
library(leaps)
library(TeachingDemos)
library(FactoMineR)
library(factoextra)
library(ROCR)
library(plotROC)
```

## Etude CSP

Une première analyse nous permet de rassembler toutes les CSP comportant moins de 1,5% des assurés dans une seule et même classe. Il s'agit des classes : CSP17,2,20,21,22,26,3,30,37,38,40,41,44,45,47,49,51,56,57,59,6,61,63,65 et 7.

La suite de notre étude ne portera donc que sur les classes :CSP1, 42, 46, 48, 50, 55, 60 et 66

```{r}
#J'ai procédé d'une autre manière. Voir encadré suivant
#On conserve que les CSP1, 42, 46, 48, 50, 55, 60 et 66

#data=subset(freMPL5,freMPL5$SocioCateg %in% c("CSP1","CSP42","CSP46","CSP48","CSP50","CSP55","CSP60","CSP66"))

```

Importer chez Eudes

```{r}
#On importe la base de données qu'avec les bonnes CSP après sélection sur Excel
setwd("C:/Users/enceu/OneDrive/Bureau/Mémoire")
data=read.csv("databrute.csv",header=TRUE,sep=";",fill=F)
```

Importer chez Lucas

```{r}
setwd("C:/Users/60580/OneDrive/Documents/projet R/Depot-memoire")
data=read.csv("databrute.csv",header=TRUE,sep=";",fill=F)
```

### I) K-Means

L'objectif est de constituer différents groupes d'individus à partir de leurs caractéristiques. Ces regroupement seront faits grâce à des similitudes partagées par des mêmes individus (à partir de calcul de distance : on se servira essentiellement de la distance euclidienne dans cette étude)

Cette méthode sera utilisée pour deux variables quantitatives : Montant sinistre moyen par CSP, Fréquence de sinistres par CSP et Exposure moyen par CSP

### a) Etude des outliers

```{r}
boxplot(data$ClaimAmount[data$ClaimInd==1] ~ data$SocioCateg[data$ClaimInd==1], ylim=c(0,15000))
```

### b) Clustering

Dans la suite de cette section, on va regrouper, si possible, les 8 CSP restantes grâce à la méthode des k-means

```{r}
#On centre chaque colonne de notre dataframe data afin de pouvoir procéder aux k-means 
data1=read.csv("k_means.csv",header=TRUE,sep=";",fill=F,row.names=1)
df=scale(data1)
#Etude du nombre de clusterings que l'on va considérer grâce à différents critères

fviz_nbclust(data1,  FUNcluster = kmeans ,c("silhouette", "wss", "gap_stat"),k.max=7)

km.res <- kmeans(df, 2, nstart = 10)
km.res


fviz_cluster(km.res, data = df, centroids = 2, repel = TRUE, ellipse.type = "norm")
```

Ce premier clustering nous permet de constituer 2 clusters parmi ces 8 classes :

-   Cluster 1 : CSP1, 42, 46, 48 et 66

-   Cluster 2 : CSP 50, 55 et 60

```{r}
data1=read.csv("k_means.csv",header=TRUE,sep=";",fill=F,row.names=1)
df=scale(data1)
#Etude du nombre de clusterings que l'on va considérer grâce à différents critères

fviz_nbclust(data1,  FUNcluster = kmeans ,c("silhouette", "wss", "gap_stat"),k.max=7)

km.res <- kmeans(df, 3, nstart = 10)
km.res


fviz_cluster(km.res, data = df, centroids = 2, repel = TRUE, ellipse.type = "norm")
```

```{r}
data1=read.csv("k_means.csv",header=TRUE,sep=";",fill=F,row.names=1)
df=scale(data1)
#Etude du nombre de clusterings que l'on va considérer grâce à différents critères

fviz_nbclust(data1,  FUNcluster = kmeans ,c("silhouette", "wss", "gap_stat"),k.max=7)

km.res <- kmeans(df, 4, nstart = 10)
km.res


fviz_cluster(km.res, data = df, centroids = 2, repel = TRUE, ellipse.type = "norm")
```

```{r}
data1=read.csv("k_means.csv",header=TRUE,sep=";",fill=F,row.names=1)
df=scale(data1)
#Etude du nombre de clusterings que l'on va considérer grâce à différents critères

fviz_nbclust(data1,  FUNcluster = kmeans ,c("silhouette", "wss", "gap_stat"),k.max=7)

km.res <- kmeans(df, 5, nstart = 10)
km.res


fviz_cluster(km.res, data = df, centroids = 2, repel = TRUE, ellipse.type = "norm")
```
